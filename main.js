(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{TW:()=>O,_0:()=>T,dm:()=>C});var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-37",headers:{authorization:"61ce8f8a-84ad-4bc8-a812-43ad64b812b9","Content-Type":"application/json"}},o=[new Promise((function(e,o){fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(t){t.ok?e(t.json()):o("Ошибка: ".concat(t.status))})).catch((function(e){console.log(e)}))})),new Promise((function(e,o){fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(t){t.ok?e(t.json()):o("Ошибка: ".concat(t.status))})).catch((function(e){console.log(e)}))}))];Promise.all(o).then((function(e){T(e[0]),O(e[1])}));var r=function(e,o){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:o,headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("ошибка: ".concat(e.status))}))},n=document.querySelector("#card-template").content,c=function(e,t,o,r){var c=n.querySelector(".card").cloneNode(!0),a=document.querySelector(".profile");c.querySelector(".card__image").src=e.link,c.querySelector(".card__image").alt=e.name,c.querySelector(".card__title").textContent=e.name;var u=c.querySelector(".card__delete-button"),i=c.querySelector(".card__like-button");return i.addEventListener("click",o),c.dataset.cardId=e._id,e.likes&&e.likes.some((function(e){return e._id===a.dataset.userId}))&&i.classList.toggle("card__like-button_is-active"),e.owner._id===a.dataset.userId?u.addEventListener("click",t):u.remove(),c.querySelector(".card__like-count").textContent=e.likes.length,c.querySelector(".card__image").addEventListener("click",r),C.prepend(c),c},a=function(e){var o,r=e.target.closest(".card");(o=r.dataset.cardId,fetch("".concat(t.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("ошибка: ".concat(e.status))}))).then((function(){r.remove()})).catch((function(e){console.error("Ошибка:",e)}))};function u(e){var t;t=e.target.classList.contains("card__like-button_is-active")?"DELETE":"PUT",r(e.target.closest(".card").dataset.cardId,t).then((function(t){e.target.nextElementSibling.textContent=t.likes.length})).catch((function(e){console.error("Ошибка:",e)})),e.target.classList.toggle("card__like-button_is-active")}var i=function(e){e.classList.remove("popup_is-opened"),e.querySelector(".popup__close").removeEventListener("click",l),e.removeEventListener("click",d),document.removeEventListener("keydown",p)},s=function(e){e.classList.add("popup_is-opened"),e.querySelector(".popup__close").addEventListener("click",l),e.addEventListener("click",d),document.addEventListener("keydown",p)};function l(e){var t=e.target.closest(".popup");i(t)}function d(e){e.target.classList.contains("popup")&&i(e.target)}function p(e){if("Escape"===e.key||27===e.keyCode){var t=document.querySelector(".popup_is-opened");i(t)}}var _,f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__submit_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},m=function(e,t,o){var r=o.inputErrorClass,n=o.errorClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r),c.classList.remove(n),c.textContent=""},y=function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach((function(o){m(e,o,t),o.setCustomValidity("")})),v(o,r,t)},v=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))},S=document.querySelector("#profile-url-input"),h=document.forms["edit-profile"],q=document.forms["new-avatar"],b=document.querySelector(".popup__input_type_name"),g=document.querySelector(".popup__input_type_description"),k=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),L=document.querySelector(".profile__edit-button"),C=document.querySelector(".places__list"),j=document.querySelector(".profile__image"),P=document.forms["new-place"],x=document.querySelector(".profile__add-button"),w=document.querySelector(".popup__input_type_card-name"),U=document.querySelector(".popup__input_type_url");function A(e){e.textContent="Сохранение..."}function I(e){e.textContent="Сохранить"}function T(e){var t=document.querySelector(".profile__image"),o=document.querySelector(".profile__title"),r=document.querySelector(".profile__description");document.querySelector(".profile").dataset.userId=e._id,t.style.backgroundImage="url(".concat(e.avatar,")"),o.textContent=e.name,r.textContent=e.about}function O(e){e.forEach((function(e){var t=c(e,a,u,B);C.append(t)}))}function B(e){var t=document.querySelector(".popup__image"),o=document.querySelector(".popup__caption"),r=e.target;t.src=r.src,t.alt=r.alt,o.textContent=r.alt,s(document.querySelector(".popup_type_image"))}j.addEventListener("click",(function(e){e.preventDefault(),S.value=j.style.backgroundImage.slice(5,-2),s(document.querySelector(".popup_type_avatar")),y(q,f)})),q.addEventListener("submit",(function(e){e.preventDefault(),A(e.target.querySelector(".popup__button"));var o,r=S.value,n=e.target.closest(".popup");(o=r,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:o})}).then((function(e){return e.ok?e.json():Promise.reject("ошибка: ".concat(e.status))}))).then((function(t){T(t),i(n),I(e.target.querySelector(".popup__button"))})).catch((function(t){console.error("Ошибка:",t),I(e.target.querySelector(".popup__button"))}))})),h.addEventListener("submit",(function(e){e.preventDefault(),A(e.target.querySelector(".popup__button"));var o,r=b.value,n=g.value,c=e.target.closest(".popup");(o={name:r,about:n},fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify(o)}).then((function(e){return e.ok?e.json():Promise.reject("ошибка: ".concat(e.status))}))).then((function(t){T(t),i(c),I(e.target.querySelector(".popup__button"))})).catch((function(t){console.error("Ошибка:",t),I(e.target.querySelector(".popup__button"))}))})),L.addEventListener("click",(function(){var e=document.querySelector(".popup_type_edit");b.value=k.textContent,g.value=E.textContent,s(e),y(h,f)})),x.addEventListener("click",(function(){var e=document.querySelector(".popup_type_new-card");s(e)})),P.addEventListener("submit",(function(e){e.preventDefault(),A(e.target.querySelector(".popup__button"));var o,r=e.target.closest(".popup"),n={name:w.value,link:U.value};y(P,f),(o=n,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify(o)}).then((function(e){return e.ok?e.json():Promise.reject("ошибка: ".concat(e.status))}))).then((function(t){c(t,a,u,B),i(r),w.value="",U.value="",I(e.target.querySelector(".popup__button"))})).catch((function(t){console.error("Ошибка:",t),I(e.target.querySelector(".popup__button"))}))})),_=f,Array.from(document.querySelectorAll(_.formSelector)).forEach((function(e){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);v(o,r,t),o.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?m(e,t,o):function(e,t,o,r){var n=r.inputErrorClass,c=r.errorClass,a=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n),a.textContent=o,a.classList.add(c)}(e,t,t.validationMessage,o)}(e,n,t),v(o,r,t)}))}))}(e,_)}))})();